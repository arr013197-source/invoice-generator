<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a2342">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice - NA Connection</title>

  <!-- ‚úÖ jsPDF paling stabil untuk iPhone & Firefox -->
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f7;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 480px;
      margin: auto;
    }
    .logo {
      text-align: center;
      margin-bottom: 10px;
    }
    .logo h2 {
      color: #007bff;
      font-weight: bold;
    }
    h3 {
      text-align: center;
      color: #222;
    }
    label {
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    table th {
      background: #f5f5f5;
    }
    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    #addItem { background: #28a745; color: white; }
    #pdfBtn { background: #007bff; color: white; }
    #waBtn { background: #25d366; color: white; }
    #emailBtn { background: #ff9800; color: white; }
  </style>
</head>

<body>
  <div class="container">
    <div class="logo">
      <h2>NA Connection</h2>
    </div>

    <form id="invoiceForm">
      <label>Nama Pelanggan:</label>
      <input type="text" id="nama" placeholder="Contoh: Budi Santoso" required>

      <label>Nomor Invoice:</label>
      <input type="text" id="invoice" placeholder="INV001" required>

      <label>Tanggal:</label>
      <input type="date" id="tanggal" required>

      <table id="itemTable">
        <thead>
          <tr>
            <th>Deskripsi</th>
            <th>Qty</th>
            <th>Harga</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" placeholder="Contoh: CCTV EZVIZ C6N"></td>
            <td><input type="number" min="1" value="1"></td>
            <td><input type="number" placeholder="500000"></td>
          </tr>
        </tbody>
      </table>

      <button type="button" id="addItem" onclick="tambahItem()">+ Tambah Item</button>

      <label>Nama Petugas / Teknisi:</label>
      <input type="text" id="petugas" placeholder="Contoh: Ridha / Tim NA Connection">

      <button id="pdfBtn" type="button" onclick="buatInvoice()">üßæ Buat Invoice PDF</button>
      <button id="waBtn" type="button" onclick="kirimWA()">üì± Kirim via WhatsApp</button>
      <button id="emailBtn" type="button" onclick="kirimEmail()">üìß Kirim via Email</button>
    </form>
  </div>

  <script>
    function tambahItem() {
      const table = document.querySelector("#itemTable tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" placeholder="Deskripsi barang"></td>
        <td><input type="number" min="1" value="1"></td>
        <td><input type="number" placeholder="Harga"></td>
      `;
      table.appendChild(row);
    }

    async function buatInvoice() {
      console.log("Tombol PDF ditekan ‚úÖ");
      if (!window.jspdf) {
        alert("jsPDF belum siap. Silakan tunggu 2 detik, lalu coba lagi.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const nama = document.getElementById('nama').value || "-";
      const invoice = document.getElementById('invoice').value || "-";
      const tanggal = document.getElementById('tanggal').value || "-";
      const petugas = document.getElementById('petugas').value || "-";

      let y = 20;
      doc.setFontSize(18);
      doc.text("INVOICE", 90, y);
      y += 10;

      doc.setFontSize(12);
      doc.text("NA Connection", 15, y);
      doc.text("Tanggal: " + tanggal, 140, y);
      y += 10;
      doc.text("Nomor Invoice: " + invoice, 15, y);
      y += 10;
      doc.text("Nama Pelanggan: " + nama, 15, y);
      y += 10;

      doc.line(15, y, 195, y);
      y += 10;

      doc.text("Deskripsi", 15, y);
      doc.text("Qty", 120, y);
      doc.text("Harga", 150, y);
      y += 5;
      doc.line(15, y, 195, y);
      y += 7;

      const rows = document.querySelectorAll("#itemTable tbody tr");
      let total = 0;
      rows.forEach((row) => {
        const [desc, qty, harga] = row.querySelectorAll("input");
        const subtotal = parseFloat(qty.value) * parseFloat(harga.value || 0);
        doc.text(desc.value || "-", 15, y);
        doc.text(qty.value || "1", 120, y);
        doc.text("Rp " + subtotal.toLocaleString('id-ID'), 150, y);
        total += subtotal;
        y += 7;
      });

      doc.line(15, y, 195, y);
      y += 10;
      doc.text("Subtotal: Rp " + total.toLocaleString('id-ID'), 120, y);
      y += 7;
      const ppn = total * 0;
      doc.text("PPN (11%): Rp " + ppn.toLocaleString('id-ID'), 120, y);
      y += 7;
      const grandTotal = total + ppn;
      doc.text("Total Akhir: Rp " + grandTotal.toLocaleString('id-ID'), 120, y);
      y += 20;

      doc.text("Petugas: " + petugas, 15, y);
      y += 20;
      doc.text("Terima kasih atas kepercayaan Anda", 15, y);

      // ‚úÖ tampilkan PDF di tab baru (lebih aman di iPhone & Firefox)
      doc.output("dataurlnewwindow");
    }

    function kirimWA() {
      const nama = document.getElementById('nama').value;
      const invoice = document.getElementById('invoice').value;
      const tanggal = document.getElementById('tanggal').value;
      const petugas = document.getElementById('petugas').value;
      const noWA = "6285182708340";

      const pesan = `Halo ${nama},%0AInvoice Anda telah dibuat:%0A` +
                    `Nomor: ${invoice}%0ATanggal: ${tanggal}%0A` +
                    `Petugas: ${petugas}%0A%0ATerima kasih atas kepercayaan Anda üôè`;

      location.href = `https://wa.me/${noWA}?text=${pesan}`;
    }

    function kirimEmail() {
      const nama = document.getElementById('nama').value;
      const invoice = document.getElementById('invoice').value;
      const tanggal = document.getElementById('tanggal').value;

      const subject = `Invoice ${invoice} - NA Connection`;
      const body = `Halo ${nama},%0AInvoice Anda:%0A` +
                   `Nomor: ${invoice}%0ATanggal: ${tanggal}%0A%0A` +
                   `Terima kasih atas kepercayaan Anda `;

      location.href = `mailto:?subject=${subject}&body=${body}`;
    }
  </script>
</body>
</html>
